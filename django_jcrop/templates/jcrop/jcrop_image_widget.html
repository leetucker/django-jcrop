{% load thumbnail i18n %}

<input type="hidden" name="{{ input_name }}-original" value="{{ image_value }}"  />
<input type="hidden" name="{{ input_name }}-crop-data" id="id_{{ input_name }}-crop-data" />
<span class="{{ input_name }} jcrop_panel">
  {% if image_value %}
  <img src="{{ MEDIA_URL }}{{ image_value }}" id="jcrop_target_{{ input_name }}" />
  {% endif %}
</span>
<script type="text/javascript" language="javascript">
(function ($) {
  var jcrop_api, boundx, boundy;
  var update_input = function(c) {
    $.extend(c, {
      image_width: $('#jcrop_target_{{ input_name }}').width(),
      image_height: $('#jcrop_target_{{ input_name }}').height()
    })
    $("#id_{{ input_name }}-crop-data").val(JSON.stringify(c))
  };

  $('#jcrop_target_{{ input_name }}').Jcrop({
    aspectRatio: {{ ratio }},
    onChange: update_input,
    onSelect: update_input,
    minSize: [ {% firstof min_x 1 %}, {% firstof min_y 1 %} ]
  }, function() {
    var bounds = this.getBounds();
    boundx = bounds[0];
    boundy = bounds[1];
    jcrop_api = this;
  });
  update_input();
}({% firstof jquery_alias "jQuery" %}));
</script>
