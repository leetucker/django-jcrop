{% load thumbnail i18n %}

<input type="hidden" name="{{ input_name }}-original" value="{{ image_value }}"  />
<input type="hidden" name="{{ input_name }}-crop-data" id="id_{{ input_name }}-crop-data"  />
<span class="{{ input_name }} jcrop_panel">
  <img src="/media/{{ image_value }}" id="jcrop_target_{{ input_name }}" />
</span>
<script type="text/javascript" language="javascript">
jQuery(document).ready(function() {
(function ($) {
  var jcrop_api, boundx, boundy;
  var update_input = function(c) {
    $.extend(c, {
      image_width: $('#jcrop_target_{{ input_name }}').width(),
      image_height: $('#jcrop_target_{{ input_name }}').height()
    })
    $("#id_{{ input_name }}-crop-data").val(JSON.stringify(c))
  };

  $('#jcrop_target_{{ input_name }}').Jcrop({
    aspectRatio: 0,
    onChange: update_input,
    onSelect: update_input
  }, function() {
    var bounds = this.getBounds();
    boundx = bounds[0];
    boundy = bounds[1];
    jcrop_api = this;
  });
  update_input();
}(jQuery));
});
</script>
